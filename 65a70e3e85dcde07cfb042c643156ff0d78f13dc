{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "d4ff3c2d_489e7643",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000004
      },
      "writtenOn": "2024-08-06T13:21:39Z",
      "side": 1,
      "message": "The goal is to avoid checks like this in the code and instead do things like are done in https://github.com/openbmc/phosphor-bmc-code-mgmt/blob/master/reboot-guard-enable.service.in. Code update should already be disabling BMC reboots using that above service.",
      "revId": "65a70e3e85dcde07cfb042c643156ff0d78f13dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d36ef4f7_ee7bf9a7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001198
      },
      "writtenOn": "2024-08-07T02:47:41Z",
      "side": 1,
      "message": "When I try to test reboot preventing while BIOS is updating, I see a issue as below:\n- Request to flash new BIOS.\n- Try to reboot BMC -\u003e It is fail as my expectation.\n- When Flashing done, try to turn on the Host -\u003e I expect it is success, but it is fail.\n\nI see that the BMC\u0027s state is `NotReady` at this point and I enabled `only-allow-boot-when-bmc-ready` option in https://github.com/openbmc/phosphor-state-manager/blob/master/meson.options#L149, that why I can not turn on the Host at step 3.\n\nI see that the `reboot-guard-enable.service` is used to prevent the `reboot.target` is called, but it can not prevent BMC\u0027s state change to `NotReady` (https://github.com/openbmc/phosphor-state-manager/blob/master/bmc_state_manager.cpp#L159).\n\nThat why I need to check BMC\u0027s state before Reboot.\n\nI have plan to create another commit on the phosphor-bmc-code-mgmt repo to remove reboot preventing in that repo after this commit is approved.",
      "parentUuid": "d4ff3c2d_489e7643",
      "revId": "65a70e3e85dcde07cfb042c643156ff0d78f13dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "282584f8_a926e12c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000003
      },
      "writtenOn": "2024-08-08T13:24:29Z",
      "side": 1,
      "message": "The advantage of the reboot-guard is that it prevents reboots from other sources other than d-bus, such as issuing \u0027reboot\u0027 from the command line, so we probably don\u0027t have a justification to approve getting it removed.\n\nHow did you request to flash the new BIOS, did you use the \u0027host-bios-upgrade\u0027 option from the phosphor-bmc-code-mgmt repo? If that was the case, maybe we could enable the reboot-guard only for bmc updates and not the bios one. This will not solve the issue where the bmc state remains in NotReady state after a failed reboot attempt, but at least won\u0027t prevent the host from powering on.\n\nAddressing the issue that the bmc is set to NotReady and the reboot fails (could be because of the reboot guard or some other reason) would require a separate solution.",
      "parentUuid": "d36ef4f7_ee7bf9a7",
      "revId": "65a70e3e85dcde07cfb042c643156ff0d78f13dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "60c5a82c_ad0ab7b4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000003
      },
      "writtenOn": "2024-08-08T13:30:49Z",
      "side": 1,
      "message": "An option could be in executeTransition() to set the bmc state back to Ready (or the state value when the reboot was issued) after issuing the reboot call via \"this-\u003ebus.call(method);\", even after a short delay. Because theoretically, if the bmc reboots, the function won\u0027t have a chance to set it back to Ready state, and if the reboot fails, then the bmc state would be back to its previous state. This can also be done in the error case (if the bus.call() fails).",
      "parentUuid": "282584f8_a926e12c",
      "revId": "65a70e3e85dcde07cfb042c643156ff0d78f13dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a2a7a6e3_0f6e2b42",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001198
      },
      "writtenOn": "2024-08-09T02:44:05Z",
      "side": 1,
      "message": "Thank you for your information @Adriana, I think we can keep the current implementation of `reboot-guard`, beside that, we can add this commit to phosphor-state-manager. I think it is correct when BMC prevents reboot request while it is in Update mode.",
      "parentUuid": "60c5a82c_ad0ab7b4",
      "revId": "65a70e3e85dcde07cfb042c643156ff0d78f13dc",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}